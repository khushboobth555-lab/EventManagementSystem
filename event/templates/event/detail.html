{% extends 'event/base.html' %}
{% load static %}
{% block title %}{{ event.name }}{% endblock %}
{% block events_active %}active{% endblock %}


{% block body %}
<div class="container event-detail">
  <div class="row">
    <!-- Event Card -->
    <div class="col-md-4">
      <div class="card event-card d-flex flex-column" style="height:100%;">
        <div class="event-image-top">
          {% if event.image %}
            <img src="{{ event.image.url }}" class="card-img-top img-responsive event-card-img" alt="{{ event.name }}">
          {% else %}
            <img src="{% static 'event/images/default_event.jpg' %}" class="card-img-top img-responsive event-card-img" alt="Event Image">
          {% endif %}
        </div>
        <div class="card-body text-center" style="flex:1; display:flex; flex-direction:column; justify-content:flex-start;">
          <h2 class="card-title event-card-title">{{ event.name }}</h2>
          <p class="card-text event-card-location">{{ event.location }}</p>
          <p class="card-text event-card-manager">Manager: <strong>{{ event.manager.first_name }} {{ event.manager.last_name }}</strong></p>
          <div class="info-bar event-info-bar">
            <span title="Date"><i class="glyphicon glyphicon-calendar"></i> {{ event.date }}</span>
            <span title="Time"><i class="glyphicon glyphicon-time"></i> {{ event.time }}</span>
            <span title="Fare"><span class="event-inr">&#8377;</span> {{ event.fare }}</span>
          </div>
          <div style="height:32px;"></div>
          <div class="btn-group btn-group-justified event-action-group" role="group" style="margin-top:auto;">
            {% if event.manager.id == request.user.id %}
              <a href="{% url 'event:update_event' event.id %}" class="btn btn-info event-btn-update" title="Update Event"><i class="glyphicon glyphicon-edit"></i> Update</a>
              <a href="{% url 'event:invite_users' event.id %}" class="btn btn-warning event-btn-invite" title="Send Invitations"><i class="glyphicon glyphicon-envelope"></i> Invite</a>
            {% else %}
              <a href="{% url 'event:buy_ticket' event.id %}" class="btn btn-success event-btn-buy" title="Buy Ticket">Buy Ticket</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <!-- Details & Attendees -->
    <div class="col-md-8">
      <div class="panel panel-info event-panel-details">
        <div class="panel-heading event-panel-heading">Event Details</div>
        <div class="panel-body">
          <div class="event-detail-row"><strong>Location:</strong> {{ event.location }}</div>
          <div class="event-detail-row"><strong>Date:</strong> {{ event.date }}</div>
          <div class="event-detail-row"><strong>Time:</strong> {{ event.time }}</div>
          <div class="event-detail-row"><strong>Fare:</strong> <span class="event-inr">&#8377;</span> {{ event.fare }}/-</div>
          <div class="event-detail-row"><strong>Manager Name:</strong> {{ event.manager.first_name }} {{ event.manager.last_name }}</div>
          <div class="event-detail-row"><strong>Manager Mobile:</strong> {{ event.manager.profile.mobile_number }} </div>
        </div>
      </div>
      <div class="panel panel-info event-panel-attendees">
        <div class="panel-heading event-panel-heading">Attendees & Invitees</div>
        <div class="panel-body">
          {% if tickets %}
            <table class="table table-striped table-bordered event-table">
              <thead>
                <tr>
                  <th>User Name</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                {% for ticket in tickets %}
                  <tr>
                    <td>{{ ticket.attendee.first_name }} {{ ticket.attendee.last_name }}</td>
                    <td>{% if ticket.flag %}Ticket{% else %}Invitation{% endif %}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p>No attendees yet.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
