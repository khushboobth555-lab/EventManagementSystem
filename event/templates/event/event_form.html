{% extends "event/base.html" %}
{% block title %}{% if event %}Update Event{% else %}Add Event{% endif %}{% endblock %}
{% block events_active %}active{% endblock %}

{% block body %}
<div class="container event-main-content event-form-container">
    <div class="card event-form-card" style="padding:0;">
        <div class="form-heading">
            {% if event %}Update Event Details{% else %}Add New Event{% endif %}
        </div>
        <div style="padding:32px 24px; border-radius:0 0 12px 12px;">
            {% if error_message %}
                <p class="text-danger event-form-error"><strong>{{ error_message }}</strong></p>
            {% endif %}
            <form class="form-horizontal" role="form" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {% include "event/form_template.html" %}
                <div class="form-group text-center event-form-btn-group">
                    <button type="submit" class="btn btn-success btn-lg">{% if event %}Update Event{% else %}Add Event{% endif %}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Clear default Django error lists
    var errorFields = document.getElementsByClassName("errorlist");
    for (var i = 0; i < errorFields.length; i++) {
        errorFields[i].innerHTML = "";
    }

    // Validate Event Name
    document.getElementById("id_name").onblur = function(ev) {
        ev.preventDefault();
        $.ajax({
            type: "GET",
            url: "{% url 'event:event_name_validate' %}",
            data: {
                "name": document.getElementById("id_name").value
            },
            success: function(response) {
                if (response.valid === "false") {
                    alert("The name '" + document.getElementById("id_name").value +
                          "' is already taken. Please choose another name for the event!");
                    document.getElementById("id_name").value = "";
                }
            }
        });
    };

    // Validate Event Date
    document.getElementById("id_date").onblur = function(ev) {
        ev.preventDefault();
        $.ajax({
            type: "GET",
            url: "{% url 'event:event_date_validate' %}",
            data: {
                "date": document.getElementById("id_date").value
            },
            success: function(response) {
                if (response.valid === "false") {
                    alert("This date: '" + document.getElementById("id_date").value +
                          "' is invalid since it has already passed. Please enter a valid date!");
                    document.getElementById("id_date").value = "";
                }
            }
        });
    };
</script>
{% endblock %}
